<div class="row align-items-center mb-4">
  <div class="col">
    <h1 class="fw-bold">Δίκτυο Χρηστών</h1>
    <p class="text-muted">Βρες συνεργάτες για τις εργαστηριακές σου ασκήσεις και ξεκίνησε μια συνομιλία.</p>
  </div>
</div>

<!-- Λίστα Όλων των Χρηστών -->
<div class="row">
  <% @users.each do |user| %>
    <div class="col-md-4 mb-4">
      <div class="card border-0 shadow-sm h-100 rounded-4">
        <div class="card-body text-center p-4">
          <!-- Avatar με το πρώτο γράμμα του ονόματος -->
          <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3 shadow-sm" style="width: 60px; height: 60px; font-size: 24px;">
            <%= (user.name.presence || user.email)[0].upcase %>
          </div>
          
          <h5 class="card-title fw-bold mb-1"><%= user.name.presence || "Ανώνυμος Χρήστης" %></h5>
          <p class="card-text text-muted small mb-3"><%= user.email %></p>
          
          <div class="mt-auto">
            <% if current_user.friends.include?(user) %>
              <button class="btn btn-light w-100 rounded-pill disabled">✅ Στις επαφές σας</button>
            <% else %>
              <%= button_to "Προσθήκη Επαφής", add_friend_user_path(user), method: :post, class: "btn btn-outline-primary w-100 rounded-pill fw-bold" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<hr class="my-5">

<!-- Ενότητα: Οι Επαφές μου -->
<div class="d-flex align-items-center mb-4">
  <h3 class="fw-bold mb-0">Οι Επαφές μου</h3>
  <span class="badge bg-primary ms-3 rounded-pill"><%= current_user.friends.count %></span>
</div>

<div class="row">
  <% if current_user.friends.any? %>
    <% current_user.friends.each do |friend| %>
      <div class="col-md-4 mb-3">
        <div class="p-3 bg-white shadow-sm rounded-4 border-start border-primary border-4 d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold text-dark"><%= friend.name.presence || friend.email %></div>
            <small class="text-success fw-bold">● Online</small>
          </div>
          
          <div class="d-flex align-items-center">
            <!-- ΚΟΥΜΠΙ CHAT (Στέλνει στον ConversationsController) -->
            <%= link_to conversations_path(sender_id: current_user.id, recipient_id: friend.id), 
                        data: { turbo_method: :post }, 
                        class: "btn btn-primary btn-sm rounded-pill px-3 me-2" do %>
              📩 Μήνυμα
            <% end %>

            <!-- ΚΟΥΜΠΙ ΔΙΑΓΡΑΦΗΣ -->
            <%= button_to remove_friend_user_path(friend), 
                          method: :delete, 
                          form: { data: { turbo_confirm: "Θέλετε να αφαιρέσετε τον χρήστη από τις επαφές σας;" } }, 
                          class: "btn btn-link text-danger p-0" do %>
              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-person-x-fill" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m6.146-2.854a.5.5 0 0 1 .708 0L14 6.293l1.146-1.147a.5.5 0 0 1 .708.708L14.707 7l1.147 1.146a.5.5 0 0 1-.708.708L14 7.707l-1.146 1.147a.5.5 0 0 1-.708-.708L13.293 7l-1.147-1.146a.5.5 0 0 1 0-.708"/>
              </svg>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="col-12">
      <div class="alert alert-light border rounded-4 text-center p-5">
        <p class="text-muted mb-0">Δεν έχετε προσθέσει ακόμα καμία επαφή. Αναζητήστε συμφοιτητές σας παραπάνω!</p>
      </div>
    </div>
  <% end %>
</div>