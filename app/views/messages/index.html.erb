<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
      
      <!-- Header -->
      <div class="card-header bg-primary text-white p-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">
          <% other_user = @conversation.sender == current_user ? @conversation.recipient : @conversation.sender %>
          ğŸ’¬ <%= other_user.name.presence || other_user.email %>
        </h5>
        <%= link_to "Î Î¯ÏƒÏ‰", users_path, class: "btn btn-sm btn-light rounded-pill px-3" %>
      </div>

      <!-- Messages Area -->
      <div class="card-body p-4 bg-light" id="messages-scroll-container" style="height: 500px; overflow-y: auto;">
        <%# Î‘ÎºÎ¿ÏÎ¼Îµ Î³Î¹Î± Î½Î­Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î¿ ActionCable %>
        <%= turbo_stream_from @conversation %>
        
        <div id="messages">
          <% @messages.each do |msg| %>
            <%= render partial: 'messages/message', locals: { message: msg, mine: (msg.user == current_user) } %>
          <% end %>
        </div>
      </div>

      <!-- Input Form -->
      <div class="card-footer bg-white p-3 border-top-0">
        <%= form_with(model: [@conversation, @message], id: "chat-form", class: "d-flex gap-2") do |f| %>
          <%= f.text_field :body, 
                           placeholder: "Î“ÏÎ¬ÏˆÏ„Îµ Î­Î½Î± Î¼Î®Î½Ï…Î¼Î±...", 
                           class: "form-control rounded-pill border-2 px-3", 
                           autocomplete: "off",
                           id: "chat-input-field" %>
          <%= f.submit "Î£Ï„ÎµÎ¯Î»Îµ", class: "btn btn-primary rounded-pill px-4 fw-bold" %>
        <% end %>
      </div>
      
    </div>
  </div>
</div>

<script>
  // Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± Î³Î¹Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ scroll ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚
  function scrollToBottom() {
    var container = document.getElementById('messages-scroll-container');
    if (container) {
      container.scrollTop = container.scrollHeight;
    }
  }

  // Î£ÎºÏÎ¿Î»Î¬ÏÎ¿Ï…Î¼Îµ ÏŒÏ„Î±Î½ Î±Î½Î¿Î¯Î³ÎµÎ¹ Î· ÏƒÎµÎ»Î¯Î´Î±
  document.addEventListener("turbo:load", scrollToBottom);

  // ÎšÎ±Î¸Î±ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï„Î¿ ÎºÎ¿Ï…Ï„Î¬ÎºÎ¹ ÎºÎ±Î¹ ÏƒÎºÏÎ¿Î»Î¬ÏÎ¿Ï…Î¼Îµ ÏŒÏ„Î±Î½ ÏƒÏ„Î­Î»Î½Î¿Ï…Î¼Îµ Î¼Î®Î½Ï…Î¼Î±
  document.addEventListener("turbo:submit-end", function(event) {
    if (event.target.id === "chat-form") {
      event.target.reset();
      scrollToBottom();
    }
  });

  // Î£ÎºÏÎ¿Î»Î¬ÏÎ¿Ï…Î¼Îµ ÏŒÏ„Î±Î½ Î­ÏÏ‡ÎµÏ„Î±Î¹ Î½Î­Î¿ Î¼Î®Î½Ï…Î¼Î± "Î¶Ï‰Î½Ï„Î±Î½Î¬" Î±Ï€ÏŒ Ï„Î¿Î½ Î¬Î»Î»Î¿Î½
  document.addEventListener("turbo:before-stream-render", function() {
    setTimeout(scrollToBottom, 50);
  });
</script>